<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Energy Appraisal - Survey Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .form-label {
            font-weight: 500;
            color: #374151;
        }
        .form-input, .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 0.75rem 1rem;
            border: 1px solid #e5e7eb;
            text-align: left;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .validation-message {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
        }
        .validation-success {
            background-color: #d1fae5;
            color: #065f46;
        }
        .validation-error {
            background-color: #fee2e2;
            color: #991b1b;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-7xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-lg">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800">Home Energy Appraisal</h1>
            <p class="text-lg text-gray-600">National Service Scheme</p>
        </header>

        <!-- Appraiser Details -->
        <section class="mb-8">
            <h2 class="section-title">Appraiser Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="appraiserName" class="form-label">Name of the Appraiser</label>
                    <input type="text" id="appraiserName" class="form-input">
                </div>
                <div>
                    <label for="enrollmentId" class="form-label">NSS Enrollment ID/KTU Register Number</label>
                    <input type="text" id="enrollmentId" class="form-input">
                </div>
                <div>
                    <label for="nssUnitNo" class="form-label">NSS Unit No</label>
                    <input type="text" id="nssUnitNo" class="form-input">
                </div>
                <div>
                    <label for="collegeName" class="form-label">Name of the College</label>
                    <input type="text" id="collegeName" class="form-input">
                </div>
            </div>
        </section>

        <!-- Section I: Electricity Connection Details -->
        <section class="mb-8">
            <h2 class="section-title">I. Electricity Connection Details</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Fields from the form -->
                <div><label for="consumerName" class="form-label">Name of the consumer</label><input type="text" id="consumerName" class="form-input"></div>
                <div><label for="familyMembers" class="form-label">Number of family members</label><input type="number" id="familyMembers" class="form-input"></div>
                <div><label for="consumerNumber" class="form-label">Consumer number (Unique ID)</label><input type="text" id="consumerNumber" class="form-input"></div>
                <div><label for="tariffCategory" class="form-label">Tariff Category</label><input type="text" id="tariffCategory" class="form-input"></div>
                <div><label for="electricalSection" class="form-label">Name of Electrical Section</label><input type="text" id="electricalSection" class="form-input"></div>
                <div><label for="connectedLoad" class="form-label">Connected Load in watts</label><input type="number" id="connectedLoad" class="form-input"></div>
                <div>
                    <label for="connectionNature" class="form-label">Nature of connection</label>
                    <select id="connectionNature" class="form-select"><option>Single Phase</option><option>Three Phase</option></select>
                </div>
                <div>
                    <label for="houseType" class="form-label">House Building Type</label>
                    <select id="houseType" class="form-select"><option>Concrete</option><option>Tiled Roof</option><option>Sheet Roof</option></select>
                </div>
                <div>
                    <label class="form-label">Own building or rental?</label>
                    <div class="flex items-center space-x-4 mt-2"><input type="radio" name="buildingOwnership" id="ownBuilding" value="own"><label for="ownBuilding">Own</label><input type="radio" name="buildingOwnership" id="rentalBuilding" value="rental"><label for="rentalBuilding">Rental</label></div>
                </div>
                <div><label for="numFloors" class="form-label">No of floors</label><input type="number" id="numFloors" class="form-input"></div>
                <div><label for="buildingArea" class="form-label">Total Building area (mÂ²)</label><input type="number" id="buildingArea" class="form-input"></div>
                <div>
                    <label for="earthingType" class="form-label">Type of Earthing</label>
                    <select id="earthingType" class="form-select"><option>Plate Earthing</option><option>Pipe Earthing</option></select>
                </div>
                 <div>
                    <label for="controlSystem" class="form-label">Control Systems</label>
                    <select id="controlSystem" class="form-select"><option>ELCB</option><option>RCCB</option></select>
                </div>
                <div><label for="numMcbs" class="form-label">Number of MCBS</label><input type="number" id="numMcbs" class="form-input"></div>
                <div>
                    <label for="meterType" class="form-label">Type of Energy Meter</label>
                    <select id="meterType" class="form-select"><option>Electromechanical</option><option>Digital</option><option>TOD</option></select>
                </div>
                <div>
                    <label class="form-label">Solar plant installed?</label>
                    <div class="flex items-center space-x-4 mt-2"><input type="radio" name="solarInstalled" id="solarYes" value="yes"><label for="solarYes">Yes</label><input type="radio" name="solarInstalled" id="solarNo" value="no"><label for="solarNo">No</label></div>
                </div>
            </div>
        </section>
        
        <!-- Other Sections -->
        <div id="other-sections">
            <!-- Solar Plant Details -->
            <section class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Solar Plant Details</h3>
                <div class="table-container">
                    <table class="min-w-full">
                        <thead><tr><th>Sl.No</th><th>Type of Solar Plant</th><th>Installed Capacity (kWp)</th><th>Remarks</th></tr></thead>
                        <tbody>
                            <tr><td>1</td><td>Off grid</td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>2</td><td>On grid</td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>3</td><td>Hybrid</td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4">
                    <label for="batteryDetails" class="form-label">Specify battery details for off-grid/hybrid plant</label>
                    <textarea id="batteryDetails" class="form-input" rows="3"></textarea>
                </div>
            </section>

            <!-- Fuel used for Cooking -->
            <section class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Fuel used for Cooking</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Sl.No</th><th>Type of fuel</th><th>Fuel Consumption per month</th><th>Unit</th><th>Remarks</th></tr></thead>
                        <tbody>
                            <tr><td>1</td><td>Firewood</td><td><input type="number" class="form-input"></td><td>Kg</td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>2</td><td>LPG Cylinder</td><td><input type="number" class="form-input"></td><td>Cylinders</td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>3</td><td>Biogas</td><td><input type="number" class="form-input"></td><td>Hours</td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>4</td><td>Induction Cooker</td><td><input type="number" class="form-input"></td><td>Hours</td><td><input type="text" class="form-input"></td></tr>
                             <tr><td>5</td><td>Others</td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input" placeholder="Specify unit"></td><td><input type="text" class="form-input"></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Water Usage Details -->
            <section class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Water Usage Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="form-label">Source of water</label><select class="form-select"><option>Open well</option><option>Bore well</option><option>Underground tank</option><option>Municipal water</option></select></div>
                    <div><label class="form-label">Municipal water bi-monthly consumption (Kilo liters)</label><input type="number" class="form-input"></div>
                    <div><label class="form-label">Municipal water bi-monthly bill (rupees)</label><input type="number" class="form-input"></div>
                    <div><label class="form-label">Overhead water tank capacity (Liters)</label><input type="number" class="form-input"></div>
                    <div><label class="form-label">Capacity of the pump (HP)</label><input type="number" step="0.5" class="form-input"></div>
                    <div><label class="form-label">Time taken to fill the tank (Hours)</label><input type="number" class="form-input"></div>
                    <div><label class="form-label">Frequency of operating the pump per day</label><input type="number" class="form-input"></div>
                    <div><label class="form-label">Daily power consumption (kWh)</label><input type="number" class="form-input" readonly></div>
                    <div><label class="form-label">Annual Power Consumption (kWh)</label><input type="number" class="form-input" readonly></div>
                    <div class="md:col-span-2"><label class="form-label">Any other remarks</label><textarea class="form-input" rows="2"></textarea></div>
                </div>
            </section>

            <!-- Vehicle Usage Details -->
            <section class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Vehicle Usage Details</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Vehicle</th><th>Type of fuel</th><th>Monthly usage (km)</th><th>Monthly Fuel Consumption (Liters or kWh)</th><th>Monthly fuel expenses (â¹)</th><th>Remarks</th></tr></thead>
                        <tbody>
                            <tr><td>2 wheeler</td><td><select class="form-select"><option>Petrol</option><option>Diesel</option><option>Electric</option></select></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>3 wheeler</td><td><select class="form-select"><option>Petrol</option><option>Diesel</option><option>Electric</option></select></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                            <tr><td>Car</td><td><select class="form-select"><option>Petrol</option><option>Diesel</option><option>Electric</option></select></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="number" class="form-input"></td><td><input type="text" class="form-input"></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Section II: Daily Usage estimation from electricity bill -->
        <section class="mb-8">
            <h2 class="section-title">II. Daily Usage Estimation from Electricity Bill</h2>
            <div class="table-container">
                <table id="bill-table">
                    <thead><tr><th>Bill No</th><th>Period Consumption (kWh)</th><th>Fixed charge (â¹)</th><th>Meter Rent (â¹)</th><th>Energy Charges (â¹)</th><th>Duty (â¹)</th><th>Other Charges (â¹)</th><th>Total (â¹)</th><th>Remarks</th></tr></thead>
                    <tbody>
                        <!-- Rows will be added by JS -->
                    </tbody>
                    <tfoot>
                        <tr class="font-bold bg-gray-100">
                            <td>Total</td>
                            <td id="total-consumption">0.00</td>
                            <td id="total-fixed-charge">0.00</td>
                            <td id="total-meter-rent">0.00</td>
                            <td id="total-energy-charges">0.00</td>
                            <td id="total-duty">0.00</td>
                            <td id="total-other-charges">0.00</td>
                            <td id="total-bill-amount">0.00</td>
                            <td></td>
                        </tr>
                        <tr class="font-bold bg-blue-100">
                            <td colspan="2">Average daily consumption in kWh (A)</td>
                            <td colspan="6" id="avg-daily-consumption-A" class="text-lg">0.00</td>
                             <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </section>

        <!-- Section III: Daily equipment wise usage Estimation -->
        <section class="mb-8">
            <h2 class="section-title">III. Daily Equipment-wise Usage Estimation</h2>
            <div class="table-container">
                <table id="equipment-table">
                    <thead><tr><th>Equipment</th><th>Daily Usage (Hours)</th><th>Rated/Usage Power (Watts)</th><th>Energy Consumption (Wh)</th><th>Remarks</th><th>Action</th></tr></thead>
                    <tbody>
                        <!-- Rows will be added by JS -->
                    </tbody>
                    <tfoot>
                        <tr class="font-bold bg-gray-100">
                            <td colspan="3">Total Energy Consumption in kWh (B)</td>
                            <td id="total-equipment-consumption-B" class="text-lg">0.00</td>
                            <td colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <button id="add-equipment-btn" class="btn btn-primary mt-4">Add Equipment</button>
            <div id="validation-result" class="validation-message hidden"></div>
        </section>

        <!-- Section IV: Identify opportunities for saving -->
        <section class="mb-8">
            <h2 class="section-title">IV. Identify Opportunities for Saving</h2>
            <div class="table-container">
                <table id="saving-table">
                    <thead><tr><th>Suggestion</th><th>Targeted Energy Saving per day (Wh)</th><th>Investment required (â¹)</th><th>Payback period (months)</th><th>Remarks</th><th>Action</th></tr></thead>
                    <tbody>
                        <!-- Rows will be added by JS -->
                    </tbody>
                </table>
            </div>
            <button id="add-saving-opportunity-btn" class="btn btn-primary mt-4">Add Suggestion</button>
        </section>

        <!-- Section V: Energy Performance Index (EPI) -->
        <section class="mb-8">
            <h2 class="section-title">V. Energy Performance Index (EPI)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                <div>
                    <label for="annual-consumption" class="form-label">Annual Consumption (kWh)</label>
                    <input type="number" id="annual-consumption" class="form-input" placeholder="Calculated from bills">
                </div>
                <div>
                    <label for="total-area" class="form-label">Total Area (mÂ²)</label>
                    <input type="number" id="total-area" class="form-input" placeholder="From Section I">
                </div>
                <div class="md:col-span-2">
                    <button id="calculate-epi-btn" class="btn btn-primary w-full">Calculate EPI & Savings</button>
                </div>
            </div>
            <div id="epi-results" class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Results will be displayed here -->
            </div>
        </section>
        
        <!-- Reference Section -->
        <section>
            <h2 class="section-title">References for Energy Appraisal</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-2">Replacement Recommendations</h3>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>Existing</th><th>Replacement</th></tr></thead>
                            <tbody>
                                <tr><td>Up to 20 Watt CFL</td><td>9 Watt LED bulb</td></tr>
                                <tr><td>Up to 100 Watt Incandescent</td><td>9 Watt LED bulb</td></tr>
                                <tr><td>Conventional tube light (42W)</td><td>20 Watt LED tube</td></tr>
                                <tr><td>15 Watt bedroom lamp</td><td>0.5 Watt LED bulb</td></tr>
                                <tr><td>Conventional ceiling fans (65W)</td><td>BLDC ceiling fans (30W)</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-2">Approximate Power of Equipment</h3>
                     <div class="table-container">
                        <table>
                            <thead><tr><th>Type</th><th>Wattage (W)</th></tr></thead>
                            <tbody>
                                <tr><td>Iron Box</td><td>1000</td></tr>
                                <tr><td>Water Heater</td><td>3000</td></tr>
                                <tr><td>Washing Machine</td><td>130</td></tr>
                                <tr><td>1 HP Water Pump</td><td>750</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- INITIALIZATION ---
            const billTableBody = document.querySelector('#bill-table tbody');
            for (let i = 1; i <= 6; i++) {
                addBillRow(i);
            }
            
            addEquipmentRow();
            addSavingOpportunityRow();

            // --- EVENT LISTENERS ---
            document.getElementById('add-equipment-btn').addEventListener('click', addEquipmentRow);
            document.getElementById('add-saving-opportunity-btn').addEventListener('click', addSavingOpportunityRow);
            document.getElementById('calculate-epi-btn').addEventListener('click', calculateEPI);

            // Link Total Area input to Section I
            document.getElementById('buildingArea').addEventListener('input', (e) => {
                document.getElementById('total-area').value = e.target.value;
            });

            // --- DYNAMIC TABLE ROW FUNCTIONS ---
            function addBillRow(billNumber) {
                const row = billTableBody.insertRow();
                row.innerHTML = `
                    <td>${billNumber}</td>
                    <td><input type="number" class="form-input bill-consumption" data-col="consumption"></td>
                    <td><input type="number" class="form-input" data-col="fixed-charge"></td>
                    <td><input type="number" class="form-input" data-col="meter-rent"></td>
                    <td><input type="number" class="form-input" data-col="energy-charges"></td>
                    <td><input type="number" class="form-input" data-col="duty"></td>
                    <td><input type="number" class="form-input" data-col="other-charges"></td>
                    <td class="row-total">0.00</td>
                    <td><input type="text" class="form-input"></td>
                `;
                row.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', calculateBillTotals);
                });
            }

            function addEquipmentRow() {
                const tableBody = document.querySelector('#equipment-table tbody');
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td><input type="text" class="form-input"></td>
                    <td><input type="number" class="form-input equipment-usage"></td>
                    <td><input type="number" class="form-input equipment-power"></td>
                    <td class="equipment-consumption">0.00</td>
                    <td><input type="text" class="form-input"></td>
                    <td><button class="btn btn-danger remove-row-btn">Remove</button></td>
                `;
                row.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', calculateEquipmentTotals);
                });
                row.querySelector('.remove-row-btn').addEventListener('click', () => {
                    row.remove();
                    calculateEquipmentTotals();
                });
            }

            function addSavingOpportunityRow() {
                const tableBody = document.querySelector('#saving-table tbody');
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td><input type="text" class="form-input"></td>
                    <td><input type="number" class="form-input saving-energy"></td>
                    <td><input type="number" class="form-input saving-investment"></td>
                    <td class="saving-payback">0.00</td>
                    <td><input type="text" class="form-input"></td>
                    <td><button class="btn btn-danger remove-row-btn">Remove</button></td>
                `;
                 row.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', calculateSavingTotals);
                });
                row.querySelector('.remove-row-btn').addEventListener('click', () => {
                    row.remove();
                });
            }
            
            // --- CALCULATION FUNCTIONS ---
            function calculateBillTotals() {
                const cols = ['consumption', 'fixed-charge', 'meter-rent', 'energy-charges', 'duty', 'other-charges'];
                const totals = { consumption: 0, 'fixed-charge': 0, 'meter-rent': 0, 'energy-charges': 0, duty: 0, 'other-charges': 0, 'bill-amount': 0 };
                let billCount = 0;

                billTableBody.querySelectorAll('tr').forEach(row => {
                    let rowTotal = 0;
                    let hasConsumption = false;
                    row.querySelectorAll('input[type="number"]').forEach(input => {
                        const val = parseFloat(input.value) || 0;
                        const col = input.dataset.col;
                        if (col) {
                           totals[col] += val;
                           if (col !== 'consumption') {
                               rowTotal += val;
                           }
                           if (col === 'consumption' && val > 0) {
                               hasConsumption = true;
                           }
                        }
                    });
                    if (hasConsumption) billCount++;
                    row.querySelector('.row-total').textContent = rowTotal.toFixed(2);
                    totals['bill-amount'] += rowTotal;
                });

                document.getElementById('total-consumption').textContent = totals.consumption.toFixed(2);
                document.getElementById('total-fixed-charge').textContent = totals['fixed-charge'].toFixed(2);
                document.getElementById('total-meter-rent').textContent = totals['meter-rent'].toFixed(2);
                document.getElementById('total-energy-charges').textContent = totals['energy-charges'].toFixed(2);
                document.getElementById('total-duty').textContent = totals.duty.toFixed(2);
                document.getElementById('total-other-charges').textContent = totals['other-charges'].toFixed(2);
                document.getElementById('total-bill-amount').textContent = totals['bill-amount'].toFixed(2);
                
                // Assuming 6 bills cover a year (bi-monthly)
                const totalDays = billCount * 60;
                const avgDailyConsumptionA = totalDays > 0 ? totals.consumption / totalDays : 0;
                document.getElementById('avg-daily-consumption-A').textContent = avgDailyConsumptionA.toFixed(2);
                document.getElementById('annual-consumption').value = totals.consumption.toFixed(2);

                validateConsumption();
            }

            function calculateEquipmentTotals() {
                let totalWh = 0;
                document.querySelectorAll('#equipment-table tbody tr').forEach(row => {
                    const usage = parseFloat(row.querySelector('.equipment-usage').value) || 0;
                    const power = parseFloat(row.querySelector('.equipment-power').value) || 0;
                    const consumptionWh = usage * power;
                    row.querySelector('.equipment-consumption').textContent = consumptionWh.toFixed(2);
                    totalWh += consumptionWh;
                });
                const totalKWh = totalWh / 1000;
                document.getElementById('total-equipment-consumption-B').textContent = totalKWh.toFixed(2);
                validateConsumption();
            }
            
            function calculateSavingTotals() {
                const avgDailyConsumptionA = parseFloat(document.getElementById('avg-daily-consumption-A').textContent) || 0;
                if (avgDailyConsumptionA === 0) return;
                
                const annualConsumption = parseFloat(document.getElementById('annual-consumption').value) || 0;
                const totalBill = parseFloat(document.getElementById('total-bill-amount').textContent) || 0;
                const costPerKwh = annualConsumption > 0 ? totalBill / annualConsumption : 5; // Default to 5 if no data

                document.querySelectorAll('#saving-table tbody tr').forEach(row => {
                    const savingWh = parseFloat(row.querySelector('.saving-energy').value) || 0;
                    const investment = parseFloat(row.querySelector('.saving-investment').value) || 0;
                    
                    if (savingWh > 0 && investment > 0) {
                        const dailyCostSaving = (savingWh / 1000) * costPerKwh;
                        const paybackDays = dailyCostSaving > 0 ? investment / dailyCostSaving : 0;
                        const paybackMonths = paybackDays > 0 ? paybackDays / 30 : 0;
                        row.querySelector('.saving-payback').textContent = paybackMonths.toFixed(2);
                    } else {
                        row.querySelector('.saving-payback').textContent = '0.00';
                    }
                });
            }

            function validateConsumption() {
                const valA = parseFloat(document.getElementById('avg-daily-consumption-A').textContent) || 0;
                const valB = parseFloat(document.getElementById('total-equipment-consumption-B').textContent) || 0;
                const validationDiv = document.getElementById('validation-result');

                if (valA === 0 || valB === 0) {
                    validationDiv.classList.add('hidden');
                    return;
                }

                const difference = Math.abs(valA - valB);
                const percentageDiff = (difference / valA) * 100;
                
                validationDiv.classList.remove('hidden');
                if (percentageDiff <= 10) {
                    validationDiv.textContent = `Validation successful! The difference is ${percentageDiff.toFixed(2)}%, which is within the 10% threshold.`;
                    validationDiv.className = 'validation-message validation-success';
                } else {
                    validationDiv.textContent = `Validation failed. The difference is ${percentageDiff.toFixed(2)}%, which is greater than 10%. Please verify the daily equipment usage estimation.`;
                    validationDiv.className = 'validation-message validation-error';
                }
            }
            
            function calculateEPI() {
                const annualConsumptionC = parseFloat(document.getElementById('annual-consumption').value) || 0;
                const totalAreaA = parseFloat(document.getElementById('total-area').value) || 0;
                const resultsDiv = document.getElementById('epi-results');
                resultsDiv.innerHTML = '';

                if (annualConsumptionC === 0 || totalAreaA === 0) {
                    resultsDiv.innerHTML = `<p class="text-red-600 col-span-full">Please enter valid Annual Consumption and Total Area.</p>`;
                    return;
                }

                // Calculate total savings
                let totalDailySavingWh = 0;
                document.querySelectorAll('#saving-table .saving-energy').forEach(input => {
                    totalDailySavingWh += parseFloat(input.value) || 0;
                });
                const reducedAnnualConsumption = (totalDailySavingWh / 1000) * 365;
                const projectedAnnualConsumption = annualConsumptionC - reducedAnnualConsumption;

                const totalBill = parseFloat(document.getElementById('total-bill-amount').textContent) || 0;
                const costPerKwh = annualConsumptionC > 0 ? totalBill / annualConsumptionC : 5; // Use average rate or default

                const annualBillReduction = reducedAnnualConsumption * costPerKwh;
                const co2Reduction = reducedAnnualConsumption * 0.79; // 0.79 kg CO2 per kWh

                const presentEPI = annualConsumptionC / totalAreaA;
                const projectedEPI = projectedAnnualConsumption / totalAreaA;

                resultsDiv.innerHTML = `
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800">Present EPI</h4>
                        <p class="text-2xl font-bold text-blue-900">${presentEPI.toFixed(2)} kWh/mÂ²/year</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">Projected EPI</h4>
                        <p class="text-2xl font-bold text-green-900">${projectedEPI.toFixed(2)} kWh/mÂ²/year</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-800">Annual Consumption Reduction</h4>
                        <p class="text-2xl font-bold text-yellow-900">${reducedAnnualConsumption.toFixed(2)} kWh</p>
                    </div>
                    <div class="bg-indigo-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-indigo-800">Annual Bill Reduction</h4>
                        <p class="text-2xl font-bold text-indigo-900">â¹ ${annualBillReduction.toFixed(2)}</p>
                    </div>
                     <div class="bg-red-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-red-800">Annual COâ Emission Reduction</h4>
                        <p class="text-2xl font-bold text-red-900">${co2Reduction.toFixed(2)} kgCOâ</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
